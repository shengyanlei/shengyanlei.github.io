{
    "version": "https://jsonfeed.org/version/1",
    "title": "碎念随风 • All posts by \"大数据\" tag",
    "description": "人海未见之时，我亦独行在这城市。 料峭，春醒，酷暑，骤雨，寒意四起，大雁南飞，而后，大雪，寒风， 斗转星移，人间寒暑。",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2024/10/22/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink-Sql/",
            "url": "http://example.com/2024/10/22/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink-Sql/",
            "title": "Flink-Sql",
            "date_published": "2024-10-22T03:05:29.000Z",
            "content_html": "<h5 id=\"启动flink测试环境\"><a class=\"markdownIt-Anchor\" href=\"#启动flink测试环境\">#</a> 启动 flink 测试环境</h5>\n<ol>\n<li>启动本地集群</li>\n</ol>\n<pre><code>bin/start-cluster.sh\n</code></pre>\n<ol start=\"2\">\n<li>启动 sql-client</li>\n</ol>\n<pre><code>bin/sql-client.sh\n</code></pre>\n<ol start=\"3\">\n<li>\n<p>sql-client 的 3 种模式</p>\n<ol>\n<li>’table‘</li>\n</ol>\n<pre><code>set 'sql-client.execution.result-mode' = 'table';\n</code></pre>\n<p><img data-src=\"https://note.youdao.com/yws/api/personal/file/WEB13efebe94a01a127df68db18df092509?method=download&amp;shareKey=4587cc20c2ba9c4aa65d61562d654fbe\" alt=\"image-20241022134808047\"></p>\n<ol start=\"2\">\n<li>‘changelog’</li>\n</ol>\n<pre><code>set 'sql-client.execution.result-mode' = 'changelog';\n</code></pre>\n<ol start=\"3\">\n<li>‘tableau’</li>\n</ol>\n<pre><code>set 'sql-client.execution.result-mode' = 'tableau';\n</code></pre>\n</li>\n<li>\n<p>设置批处理 / 流处理模式</p>\n</li>\n</ol>\n<pre><code>set 'execution.runtime-mode'='batch';\nset 'execution.runtime-mode'='streaming';\n</code></pre>\n<h5 id=\"创建不同数据源的表\"><a class=\"markdownIt-Anchor\" href=\"#创建不同数据源的表\">#</a> 创建不同数据源的表</h5>\n<h6 id=\"kafka\"><a class=\"markdownIt-Anchor\" href=\"#kafka\">#</a> kafka</h6>\n<ol>\n<li>kafka-csv</li>\n</ol>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">if</span> <span class=\"token operator\">not</span> <span class=\"token keyword\">exists</span> kafka_table<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>user_id <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>item_id <span class=\"token keyword\">bigint</span> <span class=\"token keyword\">comment</span> <span class=\"token string\">'物品id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>behavior string <span class=\"token keyword\">comment</span> <span class=\"token string\">'行为'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ts timestamp_ltz<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> metadata <span class=\"token keyword\">from</span> <span class=\"token string\">'timestamp'</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">'connector'</span><span class=\"token operator\">=</span><span class=\"token string\">'kafka'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">'topic'</span> <span class=\"token operator\">=</span><span class=\"token string\">'topic_flinksql'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token string\">'properties.bootstrap.servers'</span><span class=\"token operator\">=</span><span class=\"token string\">'nodev2001:9092'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">'properties.group.id'</span><span class=\"token operator\">=</span><span class=\"token string\">'testGroup'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token string\">'scan.startup.mode'</span><span class=\"token operator\">=</span><span class=\"token string\">'earliest-offset'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">'format'</span><span class=\"token operator\">=</span><span class=\"token string\">'csv'</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ol start=\"2\">\n<li>数据样例</li>\n</ol>\n<figure class=\"highlight csv\"><figcaption data-lang=\"csv\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token value\">6</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token value\">7</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token value\">8</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token value\">9</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token value\">10</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token value\">11</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token value\">12</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token value\">13</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token value\">14</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token value\">15</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token value\">16</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token value\">17</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token value\">18</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token value\">19</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token value\">20</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token value\">21</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token value\">22</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token value\">23</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token value\">24</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token value\">25</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token value\">26</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token value\">27</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token value\">28</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token value\">29</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token value\">30</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token value\">31</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token value\">32</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token value\">33</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token value\">34</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token value\">35</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token value\">36</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token value\">37</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token value\">38</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token value\">39</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token value\">40</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token value\">41</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token value\">42</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token value\">43</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token value\">44</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token value\">45</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token value\">46</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token value\">47</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token value\">48</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token value\">49</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token value\">50</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token value\">51</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token value\">52</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token value\">53</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token value\">54</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token value\">55</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token value\">56</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token value\">57</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token value\">58</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token value\">59</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token value\">60</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token value\">61</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token value\">62</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token value\">63</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token value\">64</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token value\">65</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token value\">66</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token value\">67</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token value\">68</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token value\">69</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token value\">70</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token value\">71</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token value\">72</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token value\">73</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token value\">74</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token value\">75</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token value\">76</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token value\">77</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token value\">78</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token value\">79</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token value\">80</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token value\">81</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token value\">82</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token value\">83</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token value\">84</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token value\">85</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token value\">86</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token value\">87</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token value\">88</span><span class=\"token punctuation\">,</span><span class=\"token value\">2</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token value\">89</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token value\">90</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token value\">91</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token value\">92</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token value\">93</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">浏览</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token value\">94</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token value\">95</span><span class=\"token punctuation\">,</span><span class=\"token value\">5</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token value\">96</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">点击</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token value\">97</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token value\">98</span><span class=\"token punctuation\">,</span><span class=\"token value\">3</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token value\">99</span><span class=\"token punctuation\">,</span><span class=\"token value\">4</span><span class=\"token punctuation\">,</span><span class=\"token value\">分享</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token value\">100</span><span class=\"token punctuation\">,</span><span class=\"token value\">1</span><span class=\"token punctuation\">,</span><span class=\"token value\">评论</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>利用 kafka-json 插入数据</li>\n</ol>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">if</span> <span class=\"token operator\">not</span> <span class=\"token keyword\">exists</span> kafka_table<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>user_id <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>item_id <span class=\"token keyword\">bigint</span> <span class=\"token keyword\">comment</span> <span class=\"token string\">'物品id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>behavior string <span class=\"token keyword\">comment</span> <span class=\"token string\">'行为'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ts timestamp_ltz<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> metadata <span class=\"token keyword\">from</span> <span class=\"token string\">'timestamp'</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">'connector'</span><span class=\"token operator\">=</span><span class=\"token string\">'kafka'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">'topic'</span> <span class=\"token operator\">=</span><span class=\"token string\">'topic_flinksql'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token string\">'properties.bootstrap.servers'</span><span class=\"token operator\">=</span><span class=\"token string\">'nodev2001:9092'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">'properties.group.id'</span><span class=\"token operator\">=</span><span class=\"token string\">'testGroup'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token string\">'scan.startup.mode'</span><span class=\"token operator\">=</span><span class=\"token string\">'earliest-offset'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">'format'</span><span class=\"token operator\">=</span><span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token string\">'json.ignore-parse-errors'</span><span class=\"token operator\">=</span><span class=\"token string\">'true'</span>  <span class=\"token comment\">// 忽略解析错误</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ol start=\"5\">\n<li>数据示例</li>\n</ol>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">12</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">13</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">15</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">17</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">18</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">19</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">21</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">22</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">23</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">24</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">25</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">26</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">27</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">29</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">31</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">33</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">34</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">35</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">37</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">38</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">39</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">41</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">42</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">43</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">45</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">46</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">47</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">49</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">51</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">52</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">53</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">54</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">55</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">56</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"分享\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">58</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">59</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">60</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">61</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"评论\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">62</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">63</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">65</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"浏览\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">66</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token property\">\"user_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">67</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"item_id\"</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token property\">\"behavior\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"点击\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"6\">\n<li>创建 kafka 表可以使用的元数据信息作为字段</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">键</th>\n<th style=\"text-align:center\">数据类型</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">R/W</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>topic</code></td>\n<td style=\"text-align:center\"><code>STRING NOT NULL</code></td>\n<td style=\"text-align:center\">Kafka 记录的 Topic 名。</td>\n<td style=\"text-align:center\"><code>R</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>partition</code></td>\n<td style=\"text-align:center\"><code>INT NOT NULL</code></td>\n<td style=\"text-align:center\">Kafka 记录的 partition ID。</td>\n<td style=\"text-align:center\"><code>R</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>headers</code></td>\n<td style=\"text-align:center\"><code>MAP NOT NULL</code></td>\n<td style=\"text-align:center\">二进制 Map 类型的 Kafka 记录头（Header）。</td>\n<td style=\"text-align:center\"><code>R/W</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>leader-epoch</code></td>\n<td style=\"text-align:center\"><code>INT NULL</code></td>\n<td style=\"text-align:center\">Kafka 记录的 Leader epoch（如果可用）。</td>\n<td style=\"text-align:center\"><code>R</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>offset</code></td>\n<td style=\"text-align:center\"><code>BIGINT NOT NULL</code></td>\n<td style=\"text-align:center\">Kafka 记录在 partition 中的 offset。</td>\n<td style=\"text-align:center\"><code>R</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>timestamp</code></td>\n<td style=\"text-align:center\"><code>TIMESTAMP_LTZ(3) NOT NULL</code></td>\n<td style=\"text-align:center\">Kafka 记录的时间戳。</td>\n<td style=\"text-align:center\"><code>R/W</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>timestamp-type</code></td>\n<td style=\"text-align:center\"><code>STRING NOT NULL</code></td>\n<td style=\"text-align:center\">Kafka 记录的时间戳类型。可能的类型有 “NoTimestampType”， “CreateTime”（会在写入元数据时设置），或 “LogAppendTime”。</td>\n<td style=\"text-align:center\"><code>R</code></td>\n</tr>\n</tbody>\n</table>\n<h6 id=\"hive\"><a class=\"markdownIt-Anchor\" href=\"#hive\">#</a> hive</h6>\n<ol>\n<li>\n<p>配置支持 hive 环境：要与 Hive 集成，您需要在 Flink 下的 <code>/lib/</code>  目录中添加一些额外的依赖包， 以便通过 Table API 或 SQL Client 与 Hive 进行交互。</p>\n</li>\n<li>\n<p>下载相关的 jar 包<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIuYWxpeXVuLmNvbS9tdm4vc2VhcmNo\">阿里云云效 maven 下载地址</span>搜索 <code>flink-sql-connector-hive-3.1.3_2.12</code></p>\n</li>\n<li>\n<p>Apache Hive 是基于 Hadoop 之上构建的，首先您需要在环境变量 Hadoop 的依赖。</p>\n<pre><code>export HADOOP_CLASSPATH=/opt/module/hadoop-3.3.2\n</code></pre>\n</li>\n<li>\n<p>Hive 的 lib 目录下找到如下两个包，复制到 flink 的 lib 目录下。</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/flink-1.17.2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   /lib</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>       // Flink's Hive connector</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>       flink-connector-hive_2.12-1.17.2.jar</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>       // Hive dependencies</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>       hive-exec-3.1.0.jar</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>       libfb303-0.9.3.jar // libfb303 is not packed into hive-exec in some versions, need to add it separately</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>       // add antlr-runtime if you need to use hive dialect</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>       antlr-runtime-3.5.2.jar</pre></td></tr></table></figure></li>\n<li>\n<p>移动 planner jar 包</p>\n<p>把  <code>FLINK_HOME/opt</code>  下的 jar 包  <code>flink-table-planner_2.12-1.17.2.jar</code>  移动到  <code>FLINK_HOME/lib</code>  下，并且将  <code>FLINK_HOME/lib</code>  下的 jar 包  <code>flink-table-planner-loader-1.17.2.jar</code>  移出去。 具体原因请参见 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9yZy9qaXJhL2Jyb3dzZS9GTElOSy0yNTEyOA==\">FLINK-25128</span>。你可以使用如下命令来完成移动 planner jar 包的工作：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mv</span> <span class=\"token variable\">$FLINK_HOME</span>/opt/flink-table-planner_2.12-1.17.2.jar <span class=\"token variable\">$FLINK_HOME</span>/lib/flink-table-planner_2.12-1.17.2.jar</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mv</span> <span class=\"token variable\">$FLINK_HOME</span>/lib/flink-table-planner-loader-1.17.2.jar <span class=\"token variable\">$FLINK_HOME</span>/opt/flink-table-planner-loader-1.17.2.jar</pre></td></tr></table></figure><p><strong>NOTE</strong>: 只有当要使用 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNy96aC9kb2NzL2Rldi90YWJsZS9oaXZlLWNvbXBhdGliaWxpdHkvaGl2ZS1kaWFsZWN0L292ZXJ2aWV3Lw==\">Hive 语法</span> 或者 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNy96aC9kb2NzL2Rldi90YWJsZS9oaXZlLWNvbXBhdGliaWxpdHkvaGl2ZXNlcnZlcjIv\">HiveServer2 endpoint</span>, 你才需要做上述的 jar 包移动。 但是在集成 Hive 的时候，推荐进行上述的操作。</p>\n</li>\n<li>\n<p>启动 hive，flink，创建 hive 的 catalog</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">CREATE</span> CATALOG myhive <span class=\"token keyword\">WITH</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">'type'</span> <span class=\"token operator\">=</span> <span class=\"token string\">'hive'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string\">'default-database'</span> <span class=\"token operator\">=</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">'hive-conf-dir'</span> <span class=\"token operator\">=</span> <span class=\"token string\">'/opt/module/hive/conf'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">USE</span> CATALOG myhive<span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>查询 hive 库的表</p>\n</li>\n</ol>\n<p><img data-src=\"https://note.youdao.com/yws/api/personal/file/WEB7f9e5bf7e5f7c102c10f358dfa099109?method=download&amp;shareKey=72ddb6bb9a3f9dcdf499ada7fe3dd1ad\" alt=\"Snipaste_2024-11-21_14-20-48\"></p>\n<ol start=\"8\">\n<li>查看 hive 表数据</li>\n</ol>\n<p><img data-src=\"https://note.youdao.com/yws/api/personal/file/WEB23c618776a675edc8182178c8f286bb5?method=download&amp;shareKey=4587cc20c2ba9c4aa65d61562d654fbe\" alt=\"Snipaste_2024-11-21_14-22-12\"></p>\n",
            "tags": [
                "大数据",
                "Flink"
            ]
        },
        {
            "id": "http://example.com/2024/05/17/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/flink%E7%AE%97%E5%AD%90%E6%80%BB%E7%BB%93/",
            "url": "http://example.com/2024/05/17/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/flink%E7%AE%97%E5%AD%90%E6%80%BB%E7%BB%93/",
            "title": "Flink算子总结",
            "date_published": "2024-05-17T02:25:29.000Z",
            "content_html": "<p>前言： Flink 提供了丰富的算子来方便开发者处理各种应用场景。</p>\n<h4 id=\"一-基本转换类算子\"><a class=\"markdownIt-Anchor\" href=\"#一-基本转换类算子\">#</a> 一、基本转换类算子</h4>\n<ol>\n<li>\n<h5 id=\"map\"><a class=\"markdownIt-Anchor\" href=\"#map\">#</a> Map：</h5>\n<ol>\n<li><strong>作用</strong>：将用户定义的 MapFunction 函数应用于数据流中的每个元素。数据流中的每个元素将作为输入元素进入用户定义的 MapFunction 函数，MapFunction 函数将对输入的元素进行转换并产生一个结果元素输出到新的数据流中。</li>\n<li>** 数据流转换：**DataStream -&gt; DataStream。</li>\n<li>** 应用场景：** 解析元素，转换数据类型。</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"flatmap\"><a class=\"markdownIt-Anchor\" href=\"#flatmap\">#</a> FlatMap：</h5>\n<ol>\n<li>** 作用：** 将用户定义的 FlatMapFunction 函数应用于数据流中的每一个元素，数据流中的每个元素将作为输入元素进入 FlatMapFunction 函数，FlatMapFunction 函数将对输入的元素进行转换并产生 0 个，1 个，或者多个结果元素输出到新的数据流中。</li>\n<li>** 数据流转换：**DataStream -&gt; DataStream。</li>\n<li>** 应用场景：** 拆分不需要的列表和数组。</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"filter\"><a class=\"markdownIt-Anchor\" href=\"#filter\">#</a> Filter：</h5>\n<ol>\n<li>** 作用：** 将用户定义的 FilterFunction 函数应用于数据流中的每个元素。数据流中的每个元素将作为输入元素进入 FilterFunction 函数，FilterFunction 函数对输入的元素进行判断来决定保留该元素还是丢弃该元素，返回 true 代表保留，返回 false 代表丢弃。</li>\n<li>** 数据流转换：**DataStream -&gt; DataStream。</li>\n<li>** 应用场景：** 数据去重</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"keyby\"><a class=\"markdownIt-Anchor\" href=\"#keyby\">#</a> KeyBy：</h5>\n<ol>\n<li>** 作用：**KeyBy 操作符的执行逻辑是将一个数据流分成不相交的流分区（分区数量和并行度一致），所有具有相同 Key 的元素都被分配到相同的流分区，在 keyby 操作符内部通过散列算法来划分元素到对应的流分区。</li>\n<li>** 数据流转换：**DataStream -&gt; KeyedStream。</li>\n<li>** 应用场景：** 聚合、状态管理、窗口操作</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"reduce\"><a class=\"markdownIt-Anchor\" href=\"#reduce\">#</a> Reduce：</h5>\n<ol>\n<li>** 作用：**Reduce 操作符应用用户定义的 ReduceFunction 函数将 KeyedStream 中具有相同 Key 元素合并为单个值，而且总是将两个元素合并为一个元素，具体细节为将上一个合并过的值和当前输入的元素结合，产生新的值发出。Reduce 操作符将 ReduceFunction 函数连续应用于同一个组的所有值，直到仅剩一个值为止。</li>\n<li>** 数据流转换：**KeyedStream -&gt; DataStream。</li>\n<li>** 应用场景：** 聚合计算</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n</ol>\n<h4 id=\"二-聚合算子\"><a class=\"markdownIt-Anchor\" href=\"#二-聚合算子\">#</a> 二、聚合算子</h4>\n<ol>\n<li>\n<h5 id=\"aggregations\"><a class=\"markdownIt-Anchor\" href=\"#aggregations\">#</a> aggregations</h5>\n<ol>\n<li>\n<p>** 作用：** 提供一系列内置的聚合逻辑，可以对 KeyStream 中具有相同 Key 的元素进行求和，求最大值或最小值等。提供两种方式对具有相同 key 的元素进行聚合计算。对于 POJO 类型的元素可以通过指定字段名称来指定聚合字段，对于元组类型的元素可以通过指定元素的索引来指定聚合字段。</p>\n</li>\n<li>\n<p>** 数据流转换：**KeyedStream-&gt; DataStream</p>\n</li>\n<li>\n<p><strong>分类：</strong></p>\n<ol>\n<li>**sum：** 返回同一个 Key 分组下指定字段的和。</li>\n<li>**min：** 返回同一个 key 分组下指定字段的最小值。</li>\n<li>**minby：** 返回同一个 key 分组下指定字段中具有最小值的元素。</li>\n<li>**max：** 返回同一个 key 分组下指定字段的最大值。</li>\n<li>**maxby：** 返回同一个 key 分组下指定字段中具有最大值的元素。</li>\n</ol>\n<p><font color=\"red\">注：类似关系型数据的 SQL 语法，Min 是取字段的最小值，MinBy 是取字段最小的一整行数据（max 同理）。</font></p>\n</li>\n<li>\n<p><strong>应用场景：</strong></p>\n</li>\n<li>\n<p><strong>代码示例：</strong></p>\n</li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n</ol>\n<h4 id=\"三-数据流操作算子\"><a class=\"markdownIt-Anchor\" href=\"#三-数据流操作算子\">#</a> 三、数据流操作算子</h4>\n<ol>\n<li>\n<h5 id=\"keyby前面介绍过\"><a class=\"markdownIt-Anchor\" href=\"#keyby前面介绍过\">#</a> keyBY（前面介绍过）</h5>\n</li>\n<li>\n<p><strong>Split 和 Select（后续版本删除，作者使用版本为 1.14）：</strong></p>\n<ol>\n<li>\n<p>** 作用：** 这两个操作符通常是组合使用的，Split 操作符根据用户定义的标准将数据流拆分为两个或者更多的数据流，Select 操作符根据用户定义的标准获取对应的数据流，以便在获取的数据流中执行后续的转换操作。</p>\n</li>\n<li>\n<p>** 数据流转换：**split：DataStream -&gt; SplitStream <br>                      select：SplitStream -&gt; DataStream</p>\n</li>\n<li>\n<p>** 应用场景：** 切分数据流，获取数据流</p>\n</li>\n<li>\n<p><strong>代码示例：</strong></p>\n</li>\n</ol>\n<pre><code class=\"language-java\">   \n</code></pre>\n</li>\n<li>\n<h5 id=\"project\"><a class=\"markdownIt-Anchor\" href=\"#project\">#</a> Project</h5>\n<ol>\n<li>** 作用：**Project 操作符作用在元素的数据类型是元组的数据流中，它根据指定的索引从元组中选择对应的字段组成一个子集。该操作符的参数是一个变长参数，类型为 Int。参数指定保留的输入元组的字段索引，输出元组的字段顺序与字段索引的顺序相对应。</li>\n<li>** 数据流转换：**DataStream -&gt;DataStream</li>\n<li>** 应用场景：** 按元组索引创建新流</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"union\"><a class=\"markdownIt-Anchor\" href=\"#union\">#</a> Union</h5>\n<ol>\n<li>** 作用：**Union 操作符负责将两个或者多个<font color=\"red\">相同类型的数据流</font>进行合并来创建一个包含数据流中所有元素的新数据流。该操作符的参数是一个变长参数，可以支持合并多个相同类型的数据流.</li>\n<li>** 数据流转换：**DataStream -&gt; DataStream</li>\n<li>** 应用场景：** 合并不同数据源相同数据类型的数据流</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"connect\"><a class=\"markdownIt-Anchor\" href=\"#connect\">#</a> Connect</h5>\n<ol>\n<li>** 作用：** 连接两个保留其类型的数据流创建新的连接流，从而允许这两个数据流共享状态。</li>\n<li>** 数据流转化：**DataStream+DataStream -&gt; ConnectedStream</li>\n<li><strong>应用场景：</strong></li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"comapcoflatmap\"><a class=\"markdownIt-Anchor\" href=\"#comapcoflatmap\">#</a> CoMap,CoFlatMap</h5>\n<ol>\n<li><strong>作用：</strong>\n<ol>\n<li>CoMap：在 connectStream 中使用 Map 操作符将用户定义的 CoMapFunction 函数应用于 ConnectedStream 中的每个元素。数据流中的每个元素将作为输入元素进入 CoMapFunction 函数，对输入的元素进行转换并产生一个结果元素输出到新的数据流中。CoMapFunction 函数提供了 map1，map2 两种转换方式分别处理 connectStream 的两个不同类型的数据流。</li>\n<li>CoFlatMap：在 connectStream 中使用 FlatMap 操作符将用户定义的 CoFlatMapFunction 函数应用于 ConnectedStream 中的每个元素。数据流中的每个元素将作为输入元素进入 CoMapFunction 函数，对输入的元素进行转换并产生 0 个，1 个，或多个结果元素输出到新的数据流中。CoFlatMapFunction 函数提供了 flatmap1，flatmap2 两种转换方式分别处理 connectStream 的两个不同类型的数据流。</li>\n</ol>\n</li>\n<li>** 数据流转换：**ConnectedStream -&gt; DataStream</li>\n<li><strong>应用场景：</strong></li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n<li>\n<h5 id=\"iterate\"><a class=\"markdownIt-Anchor\" href=\"#iterate\">#</a> Iterate</h5>\n<ol>\n<li>** 作用：** 流处理程序的迭代计算实现了一个 Step 函数并将其嵌入 IterativeStream 类型的数据流，由于流处理程序可能永远不会完成，所以没有最大迭代次数。相反需要开发者指定数据流的那一部分被反馈回迭代操作中，以及那一部分使用 split 操作符或 filter 操作符转发到下游数据流。迭代操作将一个操作符的输出重定向到某个先前的操作符，在数据流中创建 “反馈” 循环。</li>\n<li>** 数据流转换：**DataStream -&gt; IterativeStream -&gt;DataStream</li>\n<li>** 应用场景：** 更新模型算法</li>\n<li><strong>代码示例：</strong></li>\n</ol>\n<pre><code class=\"language-java\">\n</code></pre>\n</li>\n</ol>\n<h4 id=\"四-窗口算子\"><a class=\"markdownIt-Anchor\" href=\"#四-窗口算子\">#</a> 四、窗口算子</h4>\n<p>有关窗口的介绍请参考文章<a href=\"\" style=\"display: inline;white-space: nowrap;\">Flink 的窗口</a></p>\n<h5 id=\"6代码示例\"><a class=\"markdownIt-Anchor\" href=\"#6代码示例\">#</a> 6. 代码示例</h5>\n<ol>\n<li>自定义数据源 (1 秒发送一条数据)</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>shyl<span class=\"token punctuation\">.</span>bean</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>tuple<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Tuple3</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataStreamSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>environment<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StreamExecutionEnvironment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>functions<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SourceFunction</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Logger</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>slf4j<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LoggerFactory</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SimpleDateFormat</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SourceForWindow</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SourceFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tuple3</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> <span class=\"token constant\">LOG</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SourceForWindow</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">boolean</span> isRunning <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// 发送元素间隔时间</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">long</span> sleepTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token constant\">WORDS</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token string\">\"shyl\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token string\">\"shyl\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token string\">\"shyl\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token string\">\"shyl\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token string\">\"shyl\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token string\">\"java\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token string\">\"flink\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token string\">\"flink\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token string\">\"flink\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token string\">\"shyl\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token string\">\"shyl\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token string\">\"hadoop\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token string\">\"hadoop\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token string\">\"spark\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SourceForWindow</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> sleepTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sleepTime <span class=\"token operator\">=</span> sleepTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SourceContext</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tuple3</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> ctx<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>isRunning<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token class-name\">String</span> word <span class=\"token operator\">=</span> <span class=\"token constant\">WORDS</span><span class=\"token punctuation\">[</span>count <span class=\"token operator\">%</span> <span class=\"token constant\">WORDS</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token class-name\">String</span> time <span class=\"token operator\">=</span> <span class=\"token function\">getHHmmss</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token class-name\">Tuple3</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> tuple2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Tuple3</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span>tuple2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token constant\">LOG</span><span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"send data :\"</span> <span class=\"token operator\">+</span> tuple2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>sleepTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        isRunning <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getHHmmss</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token class-name\">SimpleDateFormat</span> sdf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleDateFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> sdf<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"时间:\"</span> <span class=\"token operator\">+</span> str<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://note.youdao.com/yws/api/personal/file/WEB784f05b36e6fdd6006e67f3f701aa53b?method=download&amp;shareKey=07beb93234958c59db0138ad9d34bbdf\" alt=\"数据源截图\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<hr>\n<p class=\"note note-primary\">富函数:是Flink的高级操作符，将RichFunction接口成为富函数。所有的操作符上应用的函数都有富函数版本，只需要在各种函数类名前面加上Rich前缀即可。富函数在基本函数提供的操作方法之外额外提供了一系列方法方便开发者丰富自己的业务逻辑。<br>\n1.🔴void open():执行基本操作方法前的初始化方法，它在基本的操作方法第一次被调用之前调用，因此适合在方法中进行编写初始化资源等一次性设置工作。该方法可能会转发运行时捕获的异常，当运行时捕获异常时，它将中止任务，并根据指定的重启策略决定是否重试任务。<br>\n2.🔴void close():在最后一次调用基本的操作方法之后调用它，换句话说就是在Flink程序结束前被调用，主要用于释放程序中的资源，该方法也可能转发运行时捕获的异常。<br>\n3.🔴RuntimeContext getRuntimeContext():获取有关用户定义的函数运行时的上下文信息，例如函数的并行度，函数的子任务索引或者执行函数的任务名称。RuntimeContext还提供对累加器，分布式缓存，计数器，当前配置信息，<font color='red'>状态</font>等对象的访问。<br>\n4.IterationRuntimeContext getIterationRuntimeContext():获取RuntimeContext的专用版本，该版本具有有关执行函数迭代的其他信息。仅当函数是迭代的一部分时，此IterationRuntimeContext才可用，否则调用此方法将引发异常。<br>\n5.void setRuntimeContext(RuntimeContext t):设置函数运行时的上下文，将用户定义的函数应用于操作符的并行实例时由Flink框架自动调用。</p>\n",
            "tags": [
                "大数据",
                "Flink"
            ]
        },
        {
            "id": "http://example.com/2023/12/14/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink%E7%9A%84%E4%B8%8D%E5%90%8Csource/",
            "url": "http://example.com/2023/12/14/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink%E7%9A%84%E4%B8%8D%E5%90%8Csource/",
            "title": "Flink的不同source",
            "date_published": "2023-12-14T07:31:33.000Z",
            "content_html": "<ol>\n<li><strong>Elements</strong></li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataStreamSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SingleOutputStreamOperator</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>environment<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StreamExecutionEnvironment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> elements <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">StreamExecutionEnvironment</span> env <span class=\"token operator\">=</span> <span class=\"token class-name\">StreamExecutionEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token function\">getExecutionEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        env<span class=\"token punctuation\">.</span><span class=\"token function\">setParallelism</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">DataStreamSource</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> listSource <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">fromElements</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token class-name\">SingleOutputStreamOperator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> listSource<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">-></span> i <span class=\"token operator\">+</span> i <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        env<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"from_Elements\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"2\">\n<li><strong>TextFile</strong></li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>shyl<span class=\"token punctuation\">.</span>source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>functions<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FlatMapFunction</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>tuple<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Tuple2</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataStreamSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SingleOutputStreamOperator</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>environment<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StreamExecutionEnvironment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Collector</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TextFile</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token class-name\">StreamExecutionEnvironment</span> env <span class=\"token operator\">=</span> <span class=\"token class-name\">StreamExecutionEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token function\">createLocalEnvironmentWithWebUI</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">DataStreamSource</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> source <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">readTextFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"F:\\\\BigData\\\\Flink1.4\\\\input\\\\1.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setParallelism</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">SingleOutputStreamOperator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tuple2</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> flatmap <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FlatMapFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Tuple2</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Collector</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tuple2</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> collector<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> key <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s1 <span class=\"token operator\">:</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    collector<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Tuple2</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>s1<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token class-name\">SingleOutputStreamOperator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Tuple2</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> sum <span class=\"token operator\">=</span> flatmap<span class=\"token punctuation\">.</span><span class=\"token function\">keyBy</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        sum<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        env<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TextFile\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"3\">\n<li><strong>socket</strong></li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>shyl<span class=\"token punctuation\">.</span>source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>functions<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MapFunction</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>tuple<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Tuple2</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataStreamSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SingleOutputStreamOperator</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>environment<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StreamExecutionEnvironment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> socket <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">StreamExecutionEnvironment</span> env <span class=\"token operator\">=</span> <span class=\"token class-name\">StreamExecutionEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token function\">getExecutionEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">DataStreamSource</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> source <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">socketTextStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.52.201\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">SingleOutputStreamOperator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> source<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MapFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Tuple2</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        env<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"new socket\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"4\">\n<li><strong>kafka</strong></li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>shyl<span class=\"token punctuation\">.</span>source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>eventtime<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WatermarkStrategy</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>functions<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MapFunction</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>tuple<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Tuple2</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>tuple<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Tuple3</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataStreamSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SingleOutputStreamOperator</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>environment<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StreamExecutionEnvironment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>connectors<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FlinkKafkaConsumer</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>connectors<span class=\"token punctuation\">.</span>kafka<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FlinkKafkaConsumerBase</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>serialization<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SimpleStringSchema</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Duration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Properties</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> kafka <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token class-name\">StreamExecutionEnvironment</span> env <span class=\"token operator\">=</span> <span class=\"token class-name\">StreamExecutionEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token function\">getExecutionEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//        创建 kafka 数据源的配置</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token class-name\">Properties</span> properties <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bootstrap.servers\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"192.168.52.201:9092\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        properties<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"group_id\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"kafka_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// 指定消费者读取的位置</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token class-name\">FlinkKafkaConsumer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FlinkKafkaConsumer</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleStringSchema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> properties<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setStartFromEarliest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// 尽可能从最早的记录开始</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">//        consumer.setStartFromLatest ();       // 从最新的记录开始</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">//        consumer.setStartFromTimestamp (); // 从指定的时间开始（毫秒）</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//        consumer.setStartFromGroupOffsets (); // 默认的方法 从 Kafka brokers 中的 consumer 组（consumer 属性中的 group.id 设置）提交的偏移量中开始读取分区。 如果找不到分区的偏移量，那么将会使用配置中的 auto.offset.reset 设置。</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">DataStreamSource</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> kafkasource <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">addSource</span><span class=\"token punctuation\">(</span>consumer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token class-name\">SingleOutputStreamOperator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> kafkasource<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MapFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Tuple2</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        env<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kafka_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol start=\"5\">\n<li><strong>jdbc</strong>：flink 没有对 mysql 直接提供支持 ，需要自定义数据源。</li>\n</ol>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>shyl<span class=\"token punctuation\">.</span>source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>functions<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RichParallelSourceFunction</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JDBCSourceFromMysql</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">RichParallelSourceFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>base_dic<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PreparedStatement</span> ps <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Configuration</span> parameters<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">open</span><span class=\"token punctuation\">(</span>parameters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        connection <span class=\"token operator\">=</span> <span class=\"token function\">getConnetion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">String</span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select * from base_dic\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        ps <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span><span class=\"token function\">prepareStatement</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">getRuntimeContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getJobId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ps <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            ps<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SourceContext</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>base_dic<span class=\"token punctuation\">></span></span> sourceContext<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token class-name\">ResultSet</span> resultSet <span class=\"token operator\">=</span> ps<span class=\"token punctuation\">.</span><span class=\"token function\">executeQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            base_dic basedic <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token function\">base_dic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            basedic<span class=\"token punctuation\">.</span><span class=\"token function\">setDic_code</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dic_code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            basedic<span class=\"token punctuation\">.</span><span class=\"token function\">setDic_name</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dic_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            basedic<span class=\"token punctuation\">.</span><span class=\"token function\">setParent_code</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"parent_code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            basedic<span class=\"token punctuation\">.</span><span class=\"token function\">setCreate_time</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"create_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            basedic<span class=\"token punctuation\">.</span><span class=\"token function\">setOperate_time</span><span class=\"token punctuation\">(</span>resultSet<span class=\"token punctuation\">.</span><span class=\"token function\">getString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"operate_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            sourceContext<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span>basedic<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Connection</span> <span class=\"token function\">getConnetion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token class-name\">String</span> driver <span class=\"token operator\">=</span> <span class=\"token string\">\"com.mysql.cj.jdbc.Driver\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"jdbc:mysql://192.168.52.201:3306/gmall\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token class-name\">String</span> username <span class=\"token operator\">=</span> <span class=\"token string\">\"root\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> <span class=\"token string\">\"1234kxmall!@#ABC\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token class-name\">Connection</span> con <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            <span class=\"token class-name\">Class</span><span class=\"token punctuation\">.</span><span class=\"token function\">forName</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                con <span class=\"token operator\">=</span> <span class=\"token class-name\">DriverManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SQLException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">return</span> con<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>​\t<strong>basc_inc 类</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>shyl<span class=\"token punctuation\">.</span>source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> base_dic <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> dic_code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> dic_name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> parent_code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> create_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> operate_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token function\">base_dic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getDic_code</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> dic_code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setDic_code</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> dic_code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dic_code <span class=\"token operator\">=</span> dic_code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getDic_name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> dic_name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setDic_name</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> dic_name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dic_name <span class=\"token operator\">=</span> dic_name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getParent_code</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">return</span> parent_code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setParent_code</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> parent_code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parent_code <span class=\"token operator\">=</span> parent_code<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getCreate_time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">return</span> create_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCreate_time</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> create_time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>create_time <span class=\"token operator\">=</span> create_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getOperate_time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">return</span> operate_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setOperate_time</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> operate_time<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>operate_time <span class=\"token operator\">=</span> operate_time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token string\">\"base_inc&#123;\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token string\">\"dic_code='\"</span> <span class=\"token operator\">+</span> dic_code <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token string\">\", dic_name='\"</span> <span class=\"token operator\">+</span> dic_name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token string\">\", parent_code='\"</span> <span class=\"token operator\">+</span> parent_code <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token string\">\", create_time='\"</span> <span class=\"token operator\">+</span> create_time <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                <span class=\"token string\">\", operate_time='\"</span> <span class=\"token operator\">+</span> operate_time <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token char\">'&#125;'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>​\t<strong>jdbcSource</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>shyl<span class=\"token punctuation\">.</span>source</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>functions<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MapFunction</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataStreamSource</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>datastream<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SingleOutputStreamOperator</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>flink<span class=\"token punctuation\">.</span>streaming<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span>environment<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StreamExecutionEnvironment</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JDBC</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">StreamExecutionEnvironment</span> env <span class=\"token operator\">=</span> <span class=\"token class-name\">StreamExecutionEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token function\">getExecutionEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        env<span class=\"token punctuation\">.</span><span class=\"token function\">setParallelism</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">DataStreamSource</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>base_dic<span class=\"token punctuation\">></span></span> mysqlSource <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">addSource</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">JDBCSourceFromMysql</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">SingleOutputStreamOperator</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> map <span class=\"token operator\">=</span> mysqlSource<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MapFunction</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>base_dic<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span>base_dic value<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        map<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        env<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"备注\"><a class=\"markdownIt-Anchor\" href=\"#备注\">#</a> 备注</h3>\n<p>以 flink1.4.4 版本为例，以下是 pom 文件</p>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-clients --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.flink<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>flink-clients_2.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.14.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-streaming-java --></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.flink<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>flink-streaming-java_2.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.14.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">&lt;!--            &lt;scope>provided&lt;/scope>--></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.slf4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>slf4j-api<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.7.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-runtime-web --></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.flink<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>flink-runtime-web_2.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.14.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">&lt;!--            &lt;scope>test&lt;/scope>--></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.flink<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>flink-connector-kafka_2.11<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.14.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-connector-jdbc --></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.flink<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>flink-connector-jdbc_2.12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>1.14.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">&lt;!--            &lt;scope>provided&lt;/scope>--></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token comment\">&lt;!-- https://mvnrepository.com/artifact/com.mysql/mysql-connector-j --></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.mysql<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>mysql-connector-j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>8.0.31<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure>",
            "tags": [
                "大数据",
                "Flink"
            ]
        },
        {
            "id": "http://example.com/2023/12/06/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink%E5%AD%A6%E4%B9%A0-%E4%B8%80/",
            "url": "http://example.com/2023/12/06/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink%E5%AD%A6%E4%B9%A0-%E4%B8%80/",
            "title": "Flink学习(一)",
            "date_published": "2023-12-06T03:36:08.000Z",
            "content_html": "<h3 id=\"一-flink相关名词解析\"><a class=\"markdownIt-Anchor\" href=\"#一-flink相关名词解析\">#</a> 一、Flink 相关名词解析</h3>\n<ol>\n<li>DataStream API</li>\n<li>DataSet API</li>\n<li></li>\n</ol>\n<h3 id=\"二-flink程序剖析\"><a class=\"markdownIt-Anchor\" href=\"#二-flink程序剖析\">#</a> 二、FLink 程序剖析</h3>\n<p>Flink 程序看起来像是转换的常规程序。每程序由相同的基本部分组成： <code>DataStreams</code></p>\n<ol>\n<li>获取执行环境 ， <code>execution environment</code></li>\n<li>加载 / 创建初始数据，</li>\n<li>指定此数据的转换，</li>\n<li>指定计算结果的放置位置，</li>\n<li>触发程序执行</li>\n</ol>\n<p><em>执行环境方法：</em></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">getExecutionEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">createLocalEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">createRemoteEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> host<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> jarFiles<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><em>数据源：</em></p>\n<p>基于文件：</p>\n<ul>\n<li>\n<p><code>readTextFile(path)</code> - 逐行读取文本文件，即遵守规范的文件，并将它们作为字符串返回。``</p>\n</li>\n<li>\n<p><code>readFile(fileInputFormat, path)</code> - 根据指定的文件输入格式读取（一次）文件。</p>\n</li>\n<li>\n<p><code>readFile(fileInputFormat, path, watchType, interval, pathFilter, typeInfo)</code> - 这是前两个方法内部调用的方法。它根据给定的。根据所提供的 ，该源可以定期监视（每毫秒）新数据的路径（），或者处理当前路径中的数据并退出（）。使用 ，用户可以进一步排除正在处理的文件。``</p>\n<p><em>实现：</em></p>\n<p>在底层，Flink 将文件读取过程拆分为两个子任务，即<em>目录监控</em>和<em>数据读取</em>。这些子任务中的每一个都由一个单独的实体实现。监视由单个非并行（<strong>并行度</strong> = 1）任务实现，而读取由并行运行的多个任务执行。后者的并行度等于作业并行度。单个监控任务的作用是扫描目录（定期或仅扫描一次，具体取决于目录），找到需要处理的文件，将其<em>拆分</em>，并将这些拆分分配给下游读取器。读者是读取实际数据的人。每个拆分只能由一个读取器读取，而一个读取器可以逐个读取多个拆分。</p>\n<p><em>重要提示：</em></p>\n<ol>\n<li>如果 设置为 ，则在修改文件时，将完全重新处理其内容。这可能会破坏 “恰好一次” 的语义，因为在文件末尾附加数据将导致重新处理其<strong>所有</strong>内容。</li>\n<li>如果 设置为 ，则源扫描<strong>路径一次</strong>并退出，而无需等待读取器完成对文件内容的读取。当然，读者将继续阅读，直到读取所有文件内容。关闭源会导致在此点之后不再有检查点。这可能会导致节点故障后的恢复速度变慢，因为作业将从最后一个检查点恢复读取。</li>\n</ol>\n</li>\n</ul>\n<p>基于套接字：</p>\n<ul>\n<li><code>socketTextStream</code> - 从套接字读取。元素可以用分隔符分隔。</li>\n</ul>\n<p>基于集合：</p>\n<ul>\n<li><code>fromCollection(Collection)</code> - 从 Java Java.util.Collection 创建数据流。所有元素 在集合中必须属于同一类型。</li>\n<li><code>fromCollection(Iterator, Class)</code> - 从迭代器创建数据流。该类指定 迭代器返回的元素的数据类型。</li>\n<li><code>fromElements(T ...)</code> - 从给定的对象序列创建数据流。所有对象都必须是 相同类型。</li>\n<li><code>fromParallelCollection(SplittableIterator, Class)</code> - 从迭代器创建数据流，在 平行。该类指定迭代器返回的元素的数据类型。</li>\n<li><code>generateSequence(from, to)</code> - 在给定的时间间隔内生成数字序列，在 平行。</li>\n</ul>\n<p>习惯：</p>\n<ul>\n<li><code>addSource</code> - 附加新的源函数【或者自定义数据源】。例如，要从 Apache Kafka 读取数据，可以使用。有关更多详细信息<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC9kb2NzL2Nvbm5lY3RvcnMvZGF0YXN0cmVhbS9vdmVydmlldy8=\">，请参阅连接器</span>。 <code>addSource(new FlinkKafkaConsumer&lt;&gt;(...))</code></li>\n</ul>\n<p><em>transfrom 算子</em></p>\n<p>有关可用流转换的概述，请参阅<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC9kb2NzL2Rldi9kYXRhc3RyZWFtL29wZXJhdG9ycy9vdmVydmlldy8=\">运算符</span>。</p>\n<p><em>数据接收器</em></p>\n<p>Flink 自带了多种内置的输出格式，这些格式封装在 数据流：</p>\n<ul>\n<li><code>writeAsText()</code>  /  <code>TextOutputFormat</code> - 将元素按行写入字符串。字符串是 通过调用每个元素的 <em>toString（）</em> 方法获得。</li>\n<li><code>writeAsCsv(...)</code>  /  <code>CsvOutputFormat</code> - 将元组写入逗号分隔值文件。行和字段 分隔符是可配置的。每个字段的值来自对象的 <em>toString（）</em> 方法。</li>\n<li><code>print()</code>  /  <code>printToErr()</code> - 打印 <em>toString（）</em> 值 标准输出 / 标准误差流上的每个元素。或者，可以提供前缀 （msg），即 在输出之前。这有助于区分不同的<em>打印</em>调用。如果并行度为 大于 1，则输出还将在前面加上生成输出的任务的标识符。</li>\n<li><code>writeUsingOutputFormat()</code>  /  <code>FileOutputFormat</code> - 自定义文件输出的方法和基类。支持 自定义对象到字节的转换。</li>\n<li><code>writeToSocket</code> - 根据 <code>SerializationSchema</code></li>\n<li><code>addSink</code> - 调用自定义接收器函数。Flink 捆绑了其他系统的连接器（例如 Apache Kafka），作为接收器函数实现。</li>\n</ul>\n<h3 id=\"三-执行模式\"><a class=\"markdownIt-Anchor\" href=\"#三-执行模式\">#</a> 三、执行模式</h3>\n<p>DataStream API 支持不同的运行时执行模式，你可以根据你的用例需要和作业特点进行选择。</p>\n<p>DataStream API 有一种” 经典 “的执行行为，我们称之为 <code>流（STREAMING）</code> 执行模式。这种模式适用于需要连续增量处理，而且预计无限期保持在线的无边界作业。</p>\n<p>此外，还有一种批式执行模式，我们称之为 <code>批（BATCH）</code> 执行模式。这种执行作业的方式更容易让人联想到批处理框架，比如 MapReduce。这种执行模式适用于有一个已知的固定输入，而且不会连续运行的有边界作业。</p>\n<p>Apache Flink 对流处理和批处理统一方法，意味着无论配置何种执行模式，在有界输入上执行的 DataStream 应用都会产生相同的<em>最终</em> 结果。重要的是要注意<em>最终</em> 在这里是什么意思：一个在 <code>流</code> 模式执行的作业可能会产生增量更新（想想数据库中的插入（upsert）操作），而 <code>批</code> 作业只在最后产生一个最终结果。尽管计算方法不同，只要呈现方式得当，最终结果会是相同的。</p>\n<p>可以通过设置配置执行模式。 有三个可能的值： <code>execution.runtime-mode</code></p>\n<ul>\n<li><code>STREAMING</code> ：经典 DataStream 执行模式（默认）</li>\n<li><code>BATCH</code> ：在 DataStream API 上进行批处理式执行</li>\n<li><code>AUTOMATIC</code> ：让系统根据源的有界性来决定</li>\n</ul>\n<p>这可以通过命令行参数进行配置 ，或者 在创建 / 配置 . <code>bin/flink run ...``StreamExecutionEnvironment</code></p>\n<p>以下是通过命令行配置执行模式的方法：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ bin/flink run -Dexecution.runtime-mode<span class=\"token operator\">=</span>BATCH examples/streaming/WordCount.jar</pre></td></tr></table></figure><p>此示例演示如何在代码中配置执行模式：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">StreamExecutionEnvironment</span> env <span class=\"token operator\">=</span> <span class=\"token class-name\">StreamExecutionEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token function\">getExecutionEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>env<span class=\"token punctuation\">.</span><span class=\"token function\">setRuntimeMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RuntimeExecutionMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">BATCH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>我们建议用户<strong>不要</strong>在程序中设置运行时模式，而是 提交应用程序时使用命令行进行设置。保持 无需配置应用程序代码，即可实现更大的灵活性 应用程序可以在任何执行模式下执行。</p>\n</blockquote>\n<h3 id=\"四-执行行为\"><a class=\"markdownIt-Anchor\" href=\"#四-执行行为\">#</a> 四、执行行为</h3>\n<h3 id=\"五-任务调度与网络-shuffle\"><a class=\"markdownIt-Anchor\" href=\"#五-任务调度与网络-shuffle\">#</a> 五、任务调度与网络 Shuffle</h3>\n<p>Flink 作业由不同的操作组成，这些操作在数据流图中连接在一起。系统决定如何在不同的进程 / 机器（TaskManager）上调度这些操作的执行，以及如何在它们之间 shuffle （发送）数据。</p>\n<p>将多个操作 / 算子链接在一起的功能称为<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2Rldi9kYXRhc3RyZWFtL29wZXJhdG9ycy9vdmVydmlldy8jdGFzay1jaGFpbmluZy1hbmQtcmVzb3VyY2UtZ3JvdXBz\">链</span>。Flink 称一个调度单位的一组或多个（链接在一起的）算子为一个 <em>任务</em>。通常，<em>子任务</em> 用来指代在多个 TaskManager 上并行运行的单个任务实例，但我们在这里只使用 <em>任务</em> (task) 一词。</p>\n<p>任务调度和网络 shuffle 对于 <code>批</code> 和 <code>流</code> 执行模式的执行方式不同。这主要是由于在 <code>批</code> 执行模式中，当知道输入数据是有边界的时候，<strong>Flink 可以使用更高效的数据结构和算法</strong>。</p>\n<p>我们将用这个例子来解释任务调度和网络传输的差异。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token class-name\">StreamExecutionEnvironment</span> env <span class=\"token operator\">=</span> <span class=\"token class-name\">StreamExecutionEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token function\">getExecutionEnvironment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token class-name\">DataStreamSource</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> source <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span><span class=\"token function\">fromElements</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>source<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"source\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map1\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map2\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">rebalance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map3\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map4\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">keyBy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map5\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"map6\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">sinkTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sink\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>包含 1-to-1 连接模式的操作，比如  <code>map()</code> 、  <code>flatMap()</code>  或  <code>filter()</code> ，可以直接将数据转发到下一个操作，这使得这些操作可以被链接在一起。这意味着 Flink 一般不会在他们之间插入网络 shuffle。</p>\n<p>而像  <code>keyBy()</code>  或者  <code>rebalance()</code>  这样需要在不同的任务并行实例之间进行数据 shuffle 的操作，就会引起网络 shuffle。</p>\n<p>对于上面的例子，Flink 会将操作分组为这些任务:</p>\n<ul>\n<li>任务 1:  <code>source</code> 、  <code>map1</code>  和  <code>map2</code></li>\n<li>任务 2:  <code>map3</code>  和  <code>map4</code></li>\n<li>任务 3:  <code>map5</code>  、  <code>map6</code>  和  <code>sink</code></li>\n</ul>\n<p>我们在任务 1 到任务 2、任务 2 到任务 3 之间各有一次网络 shuffle。这是该作业的可视化表示：</p>\n<img data-src=\"https://note.youdao.com/yws/api/personal/file/WEBdf4ba0a0f59f9b2a5218765dd5a35cfe?method=download&shareKey=e2599a9aa2a3734364c539c15ae47a50\">\n<h4 id=\"流执行模式\"><a class=\"markdownIt-Anchor\" href=\"#流执行模式\">#</a> 流执行模式</h4>\n<p>在 <code>流</code> 执行模式下，所有任务需要一直在线 / 运行。这使得 Flink 可以通过整个管道立即处理新的记录，以达到我们需要的连续和低延迟的流处理。这同样意味着分配给某个作业的 TaskManagers 需要有足够的资源来同时运行所有的任务。</p>\n<p>网络 shuffle 是 <em>流水线</em> 式的，这意味着记录会立即发送给下游任务，在网络层上进行一些缓冲。同样，这也是必须的，因为当处理连续的数据流时，在任务（或任务管道）之间没有可以实体化的自然数据点（时间点）。这与 <code>批</code> 执行模式形成了鲜明的对比，在 <code>批</code> 执行模式下，中间的结果可以被实体化，如下所述。</p>\n<h4 id=\"批执行模式\"><a class=\"markdownIt-Anchor\" href=\"#批执行模式\">#</a> 批执行模式</h4>\n<p>在 <code>批</code> 执行模式下，一个作业的任务可以被分离成可以一个接一个执行的阶段。我们之所以能做到这一点，是因为输入是有边界的，因此 Flink 可以在进入下一个阶段之前完全处理管道中的一个阶段。在上面的例子中，工作会有三个阶段，对应着被 shuffle 界线分开的三个任务。</p>\n<p>不同于上文所介绍的 <code>流</code> 模式立即向下游任务发送记录，分阶段处理要求 Flink 将任务的中间结果实体化到一些非永久存储中，让下游任务在上游任务已经下线后再读取。这将增加处理的延迟，但也会带来其他有趣的特性。<strong>其一，这允许 Flink 在故障发生时回溯到最新的可用结果，而不是重新启动整个任务。其二， <code>批</code> 作业可以在更少的资源上执行（就 TaskManagers 的可用槽而言），因为系统可以一个接一个地顺序执行任务。</strong></p>\n<blockquote>\n<p>TaskManagers 将至少在下游任务开始消费它们前保留中间结果（从技术上讲，它们将被保留到消费的<em>流水线区域</em>产生它们的输出为止）。在这之后，只要空间允许，它们就会被保留，以便在失败的情况下，可以回溯到前面涉及的结果。</p>\n</blockquote>\n<h3 id=\"六-事件时间\"><a class=\"markdownIt-Anchor\" href=\"#六-事件时间\">#</a> 六、事件时间</h3>\n<ul>\n<li>\n<p>** 处理时间：** 处理时间是指机器的系统时间，即执行相应的操作的时间。</p>\n<p>当流式处理程序在处理时间上运行时，所有基于时间的操作 （如时间窗口）将使用运行各自的运算符。每小时的处理时间窗口将包括所有 在系统到达特定操作员的时间之间的记录 时钟显示整点。例如，如果应用程序开始运行 上午 9：15，第一个每小时处理时间窗口将包括事件 在上午 9：15 至上午 10：00 之间处理，下一个窗口将包含事件 在上午 10：00 至上午 11：00 之间处理，依此类推。</p>\n<p>处理时间是最简单的时间概念，不需要协调 在流和计算机之间。它提供了最佳性能和 最低延迟。但是，在分布式和异步环境中 处理时间不提供确定性，因为它容易受到 记录到达系统的速度（例如，从消息 queue），以记录在 系统，以及中断（计划或其他方式）。</p>\n</li>\n<li>\n<p>** 事件时间：** 事件时间是每个事件发生的时间 其生产装置。此时间通常嵌入在记录中 在他们进入 Flink 之前，可以从中提取<em>该事件时间戳</em> 每条记录。在事件时间中，时间的进展取决于数据，而不是 任何挂钟。事件时间程序必须指定如何生成<em>事件时间 水印</em>，这是在事件时间中发出进度信号的机制。这 水印机制将在<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2NvbmNlcHRzL3RpbWUvI2V2ZW50LXRpbWUtYW5kLXdhdGVybWFya3M=\">后面</span>的部分中介绍。</p>\n<p>在理想情况下，事件时间处理将产生完全一致的结果 和确定性结果，无论事件何时到达，或者其 订购。但是，除非已知事件按顺序到达（通过 timestamp），事件时间处理在等待时会产生一些延迟 乱序事件。由于只能等待有限的时间，这限制了事件时间应用程序的确定性。</p>\n<p>假设所有数据都已到达，则事件时间操作将表现为 预期，即使在使用 无序或延迟事件，或重新处理历史数据时。例如 每小时事件时间窗口将包含承载事件的所有记录 落入该小时的时间戳，无论它们的顺序如何 到达，或当它们被处理时。</p>\n</li>\n<li>\n<p><strong>摄取时间：</strong></p>\n</li>\n</ul>\n",
            "tags": [
                "大数据",
                "Flink"
            ]
        },
        {
            "id": "http://example.com/2023/12/01/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink%E7%9A%84%E6%90%AD%E5%BB%BA/",
            "url": "http://example.com/2023/12/01/BaiduSyncdisk/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/Flink%E7%9A%84%E6%90%AD%E5%BB%BA/",
            "title": "Flink的搭建",
            "date_published": "2023-12-01T01:33:02.000Z",
            "content_html": "<h3 id=\"一-集群规划\"><a class=\"markdownIt-Anchor\" href=\"#一-集群规划\">#</a> 一、集群规划</h3>\n<table>\n<thead>\n<tr>\n<th>nodev2001</th>\n<th>nodev2002</th>\n<th>nodev2003</th>\n<th>nodev2004</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>master</td>\n<td>worker</td>\n<td>worker</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xOC96aC9kb2NzL2RlcGxveW1lbnQvamF2YV9jb21wYXRpYmlsaXR5Lw==\">适配的 java 版本</span></strong></p>\n<h3 id=\"二-安装流程\"><a class=\"markdownIt-Anchor\" href=\"#二-安装流程\">#</a> 二、安装流程</h3>\n<p>前往 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcmNoaXZlLmFwYWNoZS5vcmcvZGlzdC9mbGluay8=\">下载页面</span> 获取可运行的软件包。</p>\n<p>在下载完最新的发布版本后，复制压缩文件到 master 节点并解压：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> xzf flink-1.14.0-bin-scala_2.12.tgz</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mv</span> flink-1.14.0-bin-scala_2.12.tgz /opt/module</pre></td></tr></table></figure><p>配置 Flink：</p>\n<p>在解压完文件后，编辑 <em>conf/flink-conf.yaml</em> 文件来为集群配置 Flink。</p>\n<ol>\n<li>\n<p>设置  <code>jobmanager.rpc.address</code>  配置项指向 master 节点</p>\n</li>\n<li>\n<p>设置  <code>jobmanager.memory.process.size</code>  和  <code>taskmanager.memory.process.size</code>  配置项来定义 Flink 允许在每个节点上分配的最大内存值。</p>\n</li>\n<li>\n<p>如果 worker 节点上有你想分配到 Flink 系统的多余内存，你可以在这些特定节点的 <em>conf/flink-conf.yaml</em> 文件中重写  <code>taskmanager.memory.process.size</code>  或  <code>taskmanager.memory.flink.size</code>  的默认值。</p>\n</li>\n<li>\n<p>编辑文件 <em>conf/masters</em> 并输入 master 节点的 IP 或主机名。</p>\n</li>\n<li>\n<p>编辑文件 <em>conf/workers</em> 并输入每个 worker 节点的 IP 或主机名。</p>\n</li>\n<li>\n<p>Flink 目录复制到每个 worker 节点上。</p>\n</li>\n<li>\n<p><strong>参考 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2RlcGxveW1lbnQvY29uZmlnLw==\">配置参数页面</span> 获取更多细节以及额外的配置项。</strong></p>\n</li>\n<li>\n<p>特别地，</p>\n<ul>\n<li>每个 JobManager 的可用内存值（ <code>jobmanager.memory.process.size</code> ），</li>\n<li>每个 TaskManager 的可用内存值 （ <code>taskmanager.memory.process.size</code> ，并检查 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2RlcGxveW1lbnQvbWVtb3J5L21lbV90dW5pbmcvI2NvbmZpZ3VyZS1tZW1vcnktZm9yLXN0YW5kYWxvbmUtZGVwbG95bWVudA==\">内存调优指南</span>），</li>\n<li>每台机器的可用 CPU 数（ <code>taskmanager.numberOfTaskSlots</code> ），</li>\n<li>集群中所有 CPU 数（ <code>parallelism.default</code> ）和</li>\n<li>临时目录（ <code>io.tmp.dirs</code> ）</li>\n</ul>\n<p>的值都是非常重要的配置项。</p>\n</li>\n</ol>\n<h3 id=\"三-启动flink集群\"><a class=\"markdownIt-Anchor\" href=\"#三-启动flink集群\">#</a> 三、启动 Flink 集群</h3>\n<ol>\n<li>本地节点启动了一个 JobManager 并通过 SSH 连接到 <em>workers</em> 文件中所有的 worker 节点，master 节点的 flink 目录下</li>\n</ol>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bin/start-cluster.sh</pre></td></tr></table></figure><ol start=\"2\">\n<li>\n<p>关闭 Flink，这里同样有一个  <code>stop-cluster.sh</code>  脚本。</p>\n</li>\n<li>\n<p>为集群添加 JobManager<sup class=\"footnote-ref\"><a href=\"#fn1\" id=\"fnref1\">[1]</a></sup>/TaskManager<sup class=\"footnote-ref\"><a href=\"#fn2\" id=\"fnref2\">[2]</a></sup> 实例</p>\n<p><strong>添加 JobManager</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bin/jobmanager.sh <span class=\"token punctuation\">((</span>start<span class=\"token operator\">|</span>start-foreground<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>host<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>webui-port<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">|</span>stop<span class=\"token operator\">|</span>stop-all</pre></td></tr></table></figure><p><strong>添加 TaskManager</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bin/taskmanager.sh start<span class=\"token operator\">|</span>start-foreground<span class=\"token operator\">|</span>stop<span class=\"token operator\">|</span>stop-all</pre></td></tr></table></figure><p>确保在你想启动 / 关闭相应实例的主机上执行这些脚本。</p>\n</li>\n</ol>\n<h3 id=\"四-使用yarn管理集群\"><a class=\"markdownIt-Anchor\" href=\"#四-使用yarn管理集群\">#</a> 四、使用 Yarn 管理集群</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC9kb2NzL2RlcGxveW1lbnQvb3ZlcnZpZXcvI2FwcGxpY2F0aW9uLW1vZGU=\">Flink 的 3 种部署模式</span></p>\n<ol>\n<li>应用程序模式：</li>\n<li>作业模式：<em>Per-Job</em> 模式使用可用的资源提供程序 框架（例如 YARN、Kubernetes）为每个提交的作业启动一个集群。此群集可用于 只有那份工作。作业完成后，群集将被拆除，任何延迟的资源（文件等）都会被拆除 清除了。</li>\n<li>会话模式：多个 flink Application 向同一个 JobManager 提交，相互之间竞争资源；好处：不需要重复的启动集群。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>部署模式</th>\n<th>启动集群</th>\n<th>资源隔离</th>\n<th>JM 数量</th>\n<th>应用程序的方法</th>\n<th>适合情况</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>应用程序模式</td>\n<td>1 次</td>\n<td>隔离</td>\n<td>1/per job</td>\n<td>jM</td>\n<td>【作业模式，会话模式折中】</td>\n</tr>\n<tr>\n<td>作业模式</td>\n<td>1/per job</td>\n<td>隔离</td>\n<td>1/per job</td>\n<td>client</td>\n<td>长时间运行的作业</td>\n</tr>\n<tr>\n<td>会话模式</td>\n<td>1 次</td>\n<td>不隔离</td>\n<td>1</td>\n<td>client</td>\n<td>低延迟，运行时间短</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"五-使用问题\"><a class=\"markdownIt-Anchor\" href=\"#五-使用问题\">#</a> 五、使用问题</h3>\n<ol>\n<li>会话模式，per-job 模式启动两个任务会失败</li>\n</ol>\n<h3 id=\"脚注\"><a class=\"markdownIt-Anchor\" href=\"#脚注\">#</a> 脚注</h3>\n<p><em>JobManager</em> 具有许多与协调 Flink 应用程序的分布式执行有关的职责：它决定何时调度下一个 task（或一组 task）、对完成的 task 或执行失败做出反应、协调 checkpoint、并且协调从失败中恢复等等。这个进程由三个不同的组件组成：</p>\n<ul>\n<li>\n<p><strong>ResourceManager</strong></p>\n<p><em>ResourceManager</em> 负责 Flink 集群中的资源提供、回收、分配 - 它管理 <strong>task slots</strong>，这是 Flink 集群中资源调度的单位（请参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2NvbmNlcHRzL2ZsaW5rLWFyY2hpdGVjdHVyZS8jdGFza21hbmFnZXJz\"> TaskManagers</span>）。Flink 为不同的环境和资源提供者（例如 YARN、Kubernetes 和 standalone 部署）实现了对应的 ResourceManager。在 standalone 设置中，ResourceManager 只能分配可用 TaskManager 的 slots，而不能自行启动新的 TaskManager。</p>\n</li>\n<li>\n<p><strong>Dispatcher</strong></p>\n<p><em>Dispatcher</em> 提供了一个 REST 接口，用来提交 Flink 应用程序执行，并为每个提交的作业启动一个新的 JobMaster。它还运行 Flink WebUI 用来提供作业执行信息。</p>\n</li>\n<li>\n<p><strong>JobMaster</strong></p>\n<p><em>JobMaster</em> 负责管理单个<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2NvbmNlcHRzL2dsb3NzYXJ5LyNsb2dpY2FsLWdyYXBo\"> JobGraph</span> 的执行。Flink 集群中可以同时运行多个作业，每个作业都有自己的 JobMaster。</p>\n</li>\n</ul>\n<p>始终至少有一个 JobManager。高可用（HA）设置中可能有多个 JobManager，其中一个始终是 <em>leader</em>，其他的则是 <em>standby</em>（请参考 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2RlcGxveW1lbnQvaGEvb3ZlcnZpZXcv\">高可用（HA）</span>）。</p>\n<p><em>TaskManager</em>（也称为 <em>worker</em>）执行作业流的 task，并且缓存和交换数据流。</p>\n<p>必须始终至少有一个 TaskManager。在 TaskManager 中资源调度的最小单位是 task <em>slot</em>。TaskManager 中 task slot 的数量表示并发处理 task 的数量。请注意一个 task slot 中可以执行多个算子（请参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaWdodGxpZXMuYXBhY2hlLm9yZy9mbGluay9mbGluay1kb2NzLXJlbGVhc2UtMS4xNC96aC9kb2NzL2NvbmNlcHRzL2ZsaW5rLWFyY2hpdGVjdHVyZS8jdGFza3MtYW5kLW9wZXJhdG9yLWNoYWlucw==\"> Tasks 和算子链</span>）。</p>\n<h3 id=\"六-更换flink版本\"><a class=\"markdownIt-Anchor\" href=\"#六-更换flink版本\">#</a> 六、更换 flink 版本</h3>\n<p>由于 hive 的版本是 3.1.3，目前版本的 flink 不支持，所以升级 flink 版本为 1.17.2。官网推荐为 java11。添加 jdk11，并在启动脚本中临时切换 java 的版本为 java 11；</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>start-cluster.sh,yarn-session.sh 两个启动脚本中添加此代码</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>/opt/module/jdk-11.0.15.1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token variable\">$JAVA_HOME</span>/bin:<span class=\"token environment constant\">$PATH</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 执行 java -version 命令并保存输出</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">java_version</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span> <span class=\"token function\">java</span> <span class=\"token parameter variable\">-version</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 输出 Java 版本信息</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Java version info:\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$java_version</span>\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">bin</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">dirname</span> <span class=\"token string\">\"<span class=\"token variable\">$0</span>\"</span><span class=\"token variable\">`</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">bin</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">cd</span> <span class=\"token string\">\"<span class=\"token variable\">$bin</span>\"</span><span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">`</span></span></pre></td></tr></table></figure><hr class=\"footnotes-sep\">\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n<li id=\"fn1\" class=\"footnote-item\"><p>JobManager <a href=\"#fnref1\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n<li id=\"fn2\" class=\"footnote-item\"><p>TaskManagers <a href=\"#fnref2\" class=\"footnote-backref\">↩︎</a></p>\n</li>\n</ol>\n</section>\n",
            "tags": [
                "大数据",
                "Flink"
            ]
        }
    ]
}